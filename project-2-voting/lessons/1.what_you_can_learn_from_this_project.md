# What You Can Learn From This Project

## Q1: Explain Voting Logic

This voting system is a Solana program built with Anchor that allows users to create polls, add candidates, and cast votes within a specified time window.

### Architecture Overview

The voting system consists of three main operations:
1. **Initialize Poll** - Creates a new voting poll
2. **Initialize Candidate** - Adds candidates to a poll
3. **Vote** - Casts a vote for a candidate

### Data Structures

#### PollAccount
Stores the poll metadata:
- `poll_name`: Name of the poll (max 32 chars)
- `poll_description`: Description (max 280 chars)
- `poll_voting_start`: Unix timestamp when voting starts
- `poll_voting_end`: Unix timestamp when voting ends
- `poll_option_index`: Counter for tracking number of candidates

**PDA (Program Derived Address)**: `[b"poll", poll_id]`
- Each poll has a unique ID, and its account address is deterministically derived from the poll ID

#### CandidateAccount
Stores candidate information:
- `candidate_name`: Name of the candidate (max 32 chars)
- `candidate_votes`: Vote count for this candidate

**PDA**: `[poll_id, candidate_name]`
- Each candidate account is uniquely identified by the poll ID and candidate name

### Function Breakdown

#### 1. `initialize_poll`
**Purpose**: Creates a new voting poll

**Parameters**:
- `poll_id`: Unique identifier for the poll
- `start_time`: Unix timestamp when voting begins
- `end_time`: Unix timestamp when voting ends
- `name`: Poll name
- `description`: Poll description

**Logic**:
- Creates a `PollAccount` PDA using seeds `["poll", poll_id]`
- Stores the poll metadata and time window
- Uses `init_if_needed` to allow re-initialization if needed

**Security**: The signer pays for account creation (rent)

#### 2. `initialize_candidate`
**Purpose**: Adds a candidate option to an existing poll

**Parameters**:
- `poll_id`: The poll to add the candidate to
- `candidate`: Candidate name string

**Logic**:
- Creates a `CandidateAccount` PDA using seeds `[poll_id, candidate_name]`
- Increments `poll_option_index` in the poll account to track candidate count
- Each candidate starts with 0 votes

**Security**: 
- Verifies the poll account exists
- Signer pays for candidate account creation

#### 3. `vote`
**Purpose**: Casts a vote for a specific candidate

**Parameters**:
- `poll_id`: The poll being voted on
- `candidate`: The candidate name being voted for

**Time Validation Logic**:
```rust
let current_time = Clock::get()?.unix_timestamp;

// Check if voting has ended
if current_time > (poll_account.poll_voting_end as i64) {
    return Err(ErrorCode::VotingEnded.into());
}

// Check if voting has started
if current_time <= (poll_account.poll_voting_start as i64) {
    return Err(ErrorCode::VotingNotStarted.into());
}
```

**Vote Logic**:
- Retrieves current blockchain timestamp via `Clock::get()`
- Validates that current time is within the voting window
- Increments the candidate's vote count by 1
- No duplicate vote prevention (users can vote multiple times)

**Security**:
- Uses PDAs to ensure correct poll and candidate accounts are accessed
- Time-based validation prevents voting outside the allowed period

### Key Concepts Demonstrated

1. **PDAs (Program Derived Addresses)**: 
   - Deterministic account addresses derived from seeds
   - No need to store addresses - they can be calculated
   - Used for both poll and candidate accounts

2. **Time-based Logic**:
   - Uses Solana's `Clock` sysvar to get current time
   - Enforces voting windows with start and end times
   - Prevents voting before start or after end

3. **Account Initialization**:
   - `init_if_needed`: Allows re-initialization (useful for testing)
   - `init`: Creates new account (for candidates)
   - Space calculation using `InitSpace` derive macro

4. **String Constraints**:
   - `#[max_len(32)]` for poll and candidate names
   - `#[max_len(280)]` for descriptions
   - Prevents unbounded storage costs

### Test Flow Example

From `basic.spec.ts`:

1. **Initialize Poll** (poll_id = 1):
   - Start time: 0 (immediate)
   - End time: 1 year from now
   - Creates poll account at PDA `["poll", 1]`

2. **Initialize Candidates**:
   - Adds "smooth" candidate → PDA `[1, "smooth"]`
   - Adds "crunchy" candidate → PDA `[1, "crunchy"]`
   - Both start with 0 votes

3. **Vote**:
   - Votes for "smooth"
   - Validates time window (should pass)
   - Increments "smooth" vote count to 1

### Limitations & Potential Improvements

1. **No Duplicate Vote Prevention**: Users can vote multiple times
   - Could add a voter account PDA to track who voted

2. **No Vote Weighting**: All votes count equally
   - Could add token-weighted voting

3. **No Vote Cancellation**: Once cast, votes can't be changed
   - Could add a change_vote function

4. **No Result Querying**: No function to get poll results
   - Would need to query candidate accounts off-chain

### Security Considerations

- ✅ Time validation prevents voting outside window
- ✅ PDA seeds ensure correct account access
- ✅ Account space constraints prevent DoS attacks
- ⚠️ No rate limiting on votes
- ⚠️ No authentication/authorization checks
